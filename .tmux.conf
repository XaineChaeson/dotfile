##### ===== 基础 ===== #####
set -g history-limit 200000
set -sg escape-time 0
setw -g mode-keys vi
set -g display-time 10000
##### ===== status bar =====
# 常驻显示：例如 [PANE: h/j/k/l, q/Esc/Enter exit]
#set -ga status-right " #{?@mode,#[reverse] #{@mode}: #{@mode_hint} #[default],}"
set -g status-left-length 150
set -ga status-left ' #{?@mode,#[reverse] #{@mode}: #{@mode_hint} #[default],}'

##### ===== 重新加载配置（可选，强烈推荐）===== #####
bind-key -T prefix R source-file ~/.tmux.conf \; display-message "reloaded ~/.tmux.conf"

# mouse开关（必须，否则 WindTerm 不发滚轮事件）
set -g mouse off

##### ===== 一键切换 mouse：prefix + m =====
unbind-key -T prefix m
bind-key  -T prefix m run-shell 'tmux if-shell -F "#{mouse}" "set -g mouse off; display-message \"mouse: OFF (WindTerm drag-select)\"" "set -g mouse on; display-message \"mouse: ON (wheel scroll tmux panes)\""'

# mouse=ON 时滚轮滚 tmux 历史（更强制）
bind-key -n WheelUpPane   if-shell -F '#{mouse}' 'copy-mode -e; send -M' ''
bind-key -n WheelDownPane if-shell -F '#{mouse}' 'send -M' ''

##### ===== 可选：进入 copy-mode（键盘）=====
# prefix + [ 进入 copy-mode（tmux 默认就有，这里不必再绑）
# Vim 风格选择/复制（复制到 tmux buffer，不强求进 Windows 剪贴板）
bind-key -T copy-mode-vi v send -X begin-selection
bind-key -T copy-mode-vi V send -X select-line
bind-key -T copy-mode-vi y send -X copy-selection-and-cancel

##### ===== pane 全屏切换 ===== #####
bind-key -T prefix z resize-pane -Z

##### ===== Window layouts: prefix + g + number =====
# prefix + g：提示 + 切换到 layout 子表
unbind-key -T prefix g
bind-key  -T prefix g display-message "[Layout] 1 even-h | 2 even-v | 3 main-h | 4 main-v | 5 tiled" \; switch-client -T layout

bind-key -T layout 1 select-layout even-horizontal
bind-key -T layout 2 select-layout even-vertical
bind-key -T layout 3 select-layout main-horizontal
bind-key -T layout 4 select-layout main-vertical
bind-key -T layout 5 select-layout tiled

##### ===== Layout menu (popup) =====
bind-key -T prefix G display-menu -T "Select Layout" \
  "1 even-horizontal"   1 "select-layout even-horizontal" \
  "2 even-vertical"     2 "select-layout even-vertical" \
  "3 main-horizontal"   3 "select-layout main-horizontal" \
  "4 main-vertical"     4 "select-layout main-vertical" \
  "5 tiled (grid)"      5 "select-layout tiled"

##### ===== Pane select: 旧模式（prefix + h/j/k/l 单次切换）=====
# 先清掉可能存在的旧绑定，再重新绑成你想要的
unbind-key -T prefix h
unbind-key -T prefix j
unbind-key -T prefix k
unbind-key -T prefix l

bind-key -T prefix h select-pane -L
bind-key -T prefix j select-pane -D
bind-key -T prefix k select-pane -U
bind-key -T prefix l select-pane -R

##### ===== Pane Mode (sticky) =====
unbind-key -T prefix p
bind-key -T prefix p \
  set-option -g key-table pane \; \
  set -g @mode "PANE" \; \
  set -g @mode_hint "h/j/k/l switch, q/Esc/Enter exit"

bind-key -T pane h select-pane -L
bind-key -T pane j select-pane -D
bind-key -T pane k select-pane -U
bind-key -T pane l select-pane -R

bind-key -T pane q      set-option -g key-table root \; set -gu @mode \; set -gu @mode_hint
bind-key -T pane Escape set-option -g key-table root \; set -gu @mode \; set -gu @mode_hint
bind-key -T pane Enter  set-option -g key-table root \; set -gu @mode \; set -gu @mode_hint

##### ===== Resize Mode (sticky) =====
unbind-key -T prefix r
bind-key -T prefix r \
  set-option -g key-table resize \; \
  set -g @mode "RESIZE" \; \
  set -g @mode_hint "h/j/k/l=1, H/J/K/L=5, q/Esc/Enter exit"

bind-key -T resize h resize-pane -L 1
bind-key -T resize j resize-pane -D 1
bind-key -T resize k resize-pane -U 1
bind-key -T resize l resize-pane -R 1

bind-key -T resize H resize-pane -L 5
bind-key -T resize J resize-pane -D 5
bind-key -T resize K resize-pane -U 5
bind-key -T resize L resize-pane -R 5

bind-key -T resize q      set-option -g key-table root \; set -gu @mode \; set -gu @mode_hint
bind-key -T resize Escape set-option -g key-table root \; set -gu @mode \; set -gu @mode_hint
bind-key -T resize Enter  set-option -g key-table root \; set -gu @mode \; set -gu @mode_hint
